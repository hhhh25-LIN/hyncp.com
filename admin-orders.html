<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>查看订单 - 深圳市宏业农产品有限公司</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .order-products {
      margin: 10px 0;
      padding-left: 20px;
    }
    .order-product-item {
      margin: 5px 0;
    }
    .product-category {
      font-size: 14px;
      color: #666;
    }
    /* 底部联系电话样式 */
    .footer-contact {
      margin-top: 60px;
      padding: 20px;
      background: #f5f5f5;
      text-align: center;
      font-size: 16px;
      color: #333;
      border-top: 1px solid #eee;
    }
    .footer-address {
      margin-top: 10px;
      font-size: 15px;
      color: #555;
    }
  </style>
</head>
<body>
  <div class="nav">
    <a href="admin.html">商品管理</a>
    <a href="admin-orders.html">查看订单</a>
    <a href="change-password.html">修改密码</a>
    <a href="index.html" onclick="logout()">退出登录</a>
  </div>

  <div class="container">
    <h3 style="margin: 30px 0 20px; color: #2c3e50;">所有订单</h3>
    <div class="order-list" id="orderList">
      <div class="order-item">
        <p>暂无订单，等待客户下单商品~</p>
      </div>
    </div>

    <!-- 底部联系电话 -->
    <div class="footer-contact">
      如有疑问请拨打电话：13528492168//13410033908
      <div class="footer-address">公司地址：深圳市龙岗区横岗街道四联社区面前岭五巷三号一楼</div>
    </div>
  </div>

  <script>
    // 登录验证
    if (localStorage.getItem('isLogin') !== 'true') {
      window.location.href = 'login.html';
    }

    // 退出登录
    function logout() {
      localStorage.removeItem('isLogin');
      alert('已退出登录！');
    }

    // 加载订单列表（适配批量订单+显示分类）
    function loadOrders() {
      const orderList = document.getElementById('orderList');
      const orders = JSON.parse(localStorage.getItem('orders')) || [];
      const categories = JSON.parse(localStorage.getItem('categories')) || [];
      
      if (orders.length === 0) {
        orderList.innerHTML = '<div class="order-item"><p>暂无订单，等待客户下单商品~</p></div>';
        return;
      }

      // 渲染订单（兼容单商品/多商品订单+显示分类）
      orderList.innerHTML = orders.map(order => {
        // 判断是否是购物车批量订单
        if (order.products) {
          // 批量订单
          let productsHtml = order.products.map(p => {
            const cat = categories.find(c => c.id === p.categoryId) || {name: '未分类'};
            return `
              <div class="order-product-item">
                ${p.name} × ${p.count}${p.unit} 
                <div class="product-category">分类：${cat.name}</div>
                <div>单价：¥${p.price}/${p.unit} | 小计：¥${p.itemTotal}</div>
              </div>
            `;
          }).join('');
          
          return `
            <div class="order-item">
              <div class="order-info"><span class="order-label">订单ID：</span>${order.id}</div>
              <div class="order-info"><span class="order-label">下单时间：</span>${order.createTime}</div>
              <div class="order-info"><span class="order-label">商品：</span></div>
              <div class="order-products">${productsHtml}</div>
              <div class="order-info"><span class="order-label">订单总计：</span>¥${order.totalPrice}</div>
              <div class="order-info"><span class="order-label">公司名称：</span>${order.companyName}</div>
              <div class="order-info"><span class="order-label">备注：</span>${order.remark || '无'}</div>
            </div>
          `;
        } else {
          // 原单商品订单
          const cat = categories.find(c => c.id === order.categoryId) || {name: '未分类'};
          return `
            <div class="order-item">
              <div class="order-info"><span class="order-label">订单ID：</span>${order.id}</div>
              <div class="order-info"><span class="order-label">下单时间：</span>${order.createTime}</div>
              <div class="order-info"><span class="order-label">商品：</span>${order.productName} × ${order.count}${order.productUnit}</div>
              <div class="order-info"><span class="order-label">分类：</span>${cat.name}</div>
              <div class="order-info"><span class="order-label">单价：</span>¥${order.productPrice}/${order.productUnit} | 总价：¥${order.totalPrice}</div>
              <div class="order-info"><span class="order-label">公司名称：</span>${order.companyName}</div>
              <div class="order-info"><span class="order-label">备注：</span>${order.remark || '无'}</div>
            </div>
          `;
        }
      }).join('');
    }

    // 页面加载时执行
    window.onload = loadOrders;
  </script>
</body>
</html>